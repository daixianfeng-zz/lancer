!function(){function e(e,r){i=function(i,n,o){var t=e.extend({},{url:"",headers:{},fileKey:"file",constData:{acl:"public",isWaterMark:0},dropBg:"#f1f1f1",chunkSize:0,chunkUploadRetry:1},o),l=function(e){if(e.length){var i={};i[t.fileKey]=e,FileAPI.upload({url:t.url,headers:t.headers,data:t.constData,files:i,chunkSize:t.chunkSize*FileAPI.KB,chunkUploadRetry:t.chunkUploadRetry,progress:function(e){t.onProgress&&t.onProgress(e)},fileprogress:function(e,i,r){i.fileId=r.uid,t.onFileProgress&&t.onFileProgress(e,i)},complete:function(e,i){e?t.onFail&&t.onFail(i):t.onSuccess&&t.onSuccess(i)},filecomplete:function(e,i,n){var o={};try{o=JSON.parse(i.response)}catch(e){o={apiError:0,msg:"",data:{error:1,message:"上传链接中断"}}}var l={};r.apiError(o,l)&&!e?(n.fileId=i.uid,t.onFileSuccess&&t.onFileSuccess(o,n)):(n.fileId=i.uid,t.onFileFail&&t.onFileFail(l,i,n))}})}},s=function(e){t.onStart&&!0!==t.onStart(e,t)||FileAPI.filterFiles(e,function(e,i){return e.type&&t.fileTypeReg&&!t.fileTypeReg.test(e.type)?(gTips.error(t.fileTips,t.tipsArea),!1):e.name&&t.fileExtReg&&!t.fileExtReg.test(e.name)?(gTips.error(t.fileTips,t.tipsArea),!1):t.maxSize&&e.size>t.maxSize*FileAPI.KB?(gTips.error(t.fileTips,t.tipsArea),!1):!t.onFileStart||!0===t.onFileStart(e)},function(e,i){l(e)})};FileAPI.event.dnd(i,function(e){i.style.backgroundColor=e?t.dropBg:""},function(e){s(e)}),FileAPI.event.on(n,"change",function(e){var i=FileAPI.getFiles(e);s(i)})},window.uploadFile=i}var i={};"function"==typeof define&&define.amd?define("uploadFile",["require","jquery","G","FileAPI","gTips"],function(r){return e(r("jquery"),r("G"),r("FileAPI"),r("gTips")),i}):"object"==typeof module&&"object"==typeof module.exports?(e(require("jquery"),require("G"),require("FileAPI"),require("gTips")),module.exports=i):e(window.jQuery,window.G,window.FileAPI,window.gTips)}();