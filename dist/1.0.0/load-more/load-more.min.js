!function(){function t(t,l){var s=!1;try{var n=Object.defineProperty({},"passive",{get:function(){s=!0}});window.addEventListener("test",null,n)}catch(t){}var e={pageContent:{perpage:"5",page:"1"},pullDownState:{0:{status:0,className:"success",text:"刷新成功"},1:{status:1,className:"",text:"下拉刷新..."},2:{status:2,className:"",text:"继续下拉刷新..."},3:{status:3,className:"flip",text:"松手开始更新..."},4:{status:4,className:"loading",text:"加载中..."}},pullUpState:{0:{status:0,className:"success",text:"加载成功"},1:{status:1,className:"",text:"上拉加载更多..."},2:{status:2,className:"",text:"继续上拉加载更多..."},3:{status:3,className:"flip",text:"松手加载更多..."},4:{status:4,className:"loading",text:"加载中..."},5:{status:4,className:"all",text:"没有更多了"}},upSpring:!0,canUp:!0,canDown:!0,downFresh:!1,freshWithClear:!0,getBlockData:function(l){var s="";s='<div class="scroller">',s+='<div class="pullDown">',s+='<span class="pullDownIcon"></span>',s+='<span class="pullDownLabel">下拉刷新...</span>',s+="</div>",s+='<div class="init-data"></div>',s+='<div class="pullUp">',s+='<span class="pullUpIcon"></span>',s+='<span class="pullUpLabel">上拉加载更多...</span>',s+="</div>",s+="</div>",t(l).html(s)},getInitData:function(){return""},iScrollOpt:{}},o=function(l,s){return this.el=l,this.conf=t.extend({},e,s),this.conf.getBlockData(this.el),this.init(),this};return o.prototype={init:function(){var n=this.conf;this.page=+n.pageContent.page,this.perpage=+n.pageContent.perpage,this.pullDownOffset=t(this.el).find(".pullDown").get(0).offsetHeight,this.pullUpOffset=t(this.el).find(".pullUp").get(0).offsetHeight,this.pullUpOffsetInner=n.upOffsetInner||t(this.el).find(".pullUp").get(0).offsetHeight||50;var e=t.extend({},this.conf.iScrollOpt,{probeType:3});n.canUp&&!1===n.upSpring&&(e.bonuce=!1),this.myScroll=new l(this.el,e),this.pullDownStatus=1,this.pullUpStatus=1;var o=this;n.canDown&&(this.myScroll.on("scroll",function(){o._onScrollDownEvent(this)}),this.myScroll.on("scrollEnd",function(){o._onScrollEndDownEvent(this)})),n.canUp&&!1===n.upSpring?this.myScroll.on("scroll",function(){o._onScrollUpEventOnly(this)}):n.canUp&&(this.myScroll.on("scroll",function(){o._onScrollUpEvent(this)}),this.myScroll.on("scrollEnd",function(){o._onScrollEndUpEvent(this)})),n.getInitData(t(this.el).find(".init-data"),function(){o.page+=1,o.myScroll.refresh()}),this.perventFunc=function(t){t.preventDefault()},document.addEventListener("touchmove",this.perventFunc,!!s&&{passive:!1})},destroy:function(){this.myScroll.destroy(),this.myScroll=null,document.removeEventListener("touchmove",this.perventFunc,!!s&&{passive:!1})},_onScrollEvent:function(t){this._onScrollDownEvent(t),this._onScrollUpEvent(t)},_onScrollDownEvent:function(t){var l=this;t.y<1&&l.pullDownStatus<=2?l._setStatus("pullDown",1):t.y>1&&1===l.pullDownStatus?l._setStatus("pullDown",2):t.y>l.pullDownOffset&&l.pullDownStatus<=2?l._setStatus("pullDown",3):t.startY<l.pullDownOffset&&3===l.pullDownStatus&&l._setStatus("pullDown",2)},_onScrollUpEvent:function(t){var l=this;5!==l.pullUpStatus&&(t.y>t.maxScrollY-1&&l.pullUpStatus<=2?l._setStatus("pullUp",1):t.y<t.maxScrollY-1&&1===l.pullUpStatus?l._setStatus("pullUp",2):t.y<t.maxScrollY-l.pullUpOffset&&l.pullUpStatus<=2?l._setStatus("pullUp",3):t.startY<t.maxScrollY&&t.startY>t.maxScrollY-l.pullUpOffset&&3===l.pullUpStatus&&l._setStatus("pullUp",2))},_onScrollEndEvent:function(t){_onScrollEndDownEvent(t),_onScrollEndUpEvent(t)},_onScrollEndDownEvent:function(t){var l=this,s=(l.el,l.conf);t.y>-1&&t.startY>l.pullDownOffset&&3===l.pullDownStatus?(l._setStatus("pullDown",4),l.pullDownStatus=4,s.downFresh?l.loadFresh():l.loadDown()):3===l.pullDownStatus&&(l._setStatus("pullDown",1),l.pullDownStatus=1)},_onScrollEndUpEvent:function(t){var l=this;l.el,l.conf;t.y<t.maxScrollY+1&&t.startY<t.maxScrollY-l.pullUpOffset&&3===l.pullUpStatus?(l._setStatus("pullUp",4),l.pullUpStatus=4,l.loadUp()):3===l.pullUpStatus&&(l._setStatus("pullUp",1),l.pullUpStatus=1)},_onScrollUpEventOnly:function(t){var l=this;l.el,l.conf;if(5!==l.pullUpStatus)if(t.y>t.maxScrollY+l.pullUpOffsetInner&&l.pullUpStatus<=2)l._setStatus("pullUp",1);else{if(!(t.y<t.maxScrollY+l.pullUpOffsetInner&&l.pullUpStatus<=2))return;l._setStatus("pullUp",4),l.pullUpStatus=4,l.loadUp()}},_setStatus:function(l,s){var n=this.conf,e=null;"pullDown"===l?(e=n.pullDownState[s],t(this.el).find(".pullDown").attr("class","pullDown "+e.className),t(this.el).find(".pullDownLabel").html(e.text),this.pullDownStatus=s):(e=n.pullUpState[s],t(this.el).find(".pullUp").attr("class","pullUp "+e.className),t(this.el).find(".pullUpLabel").html(e.text),this.pullUpStatus=s)},_scrollRefresh:function(){4===this.pullDownStatus?(this._setStatus("pullDown",0),this.pullDownStatus=0):4===this.pullUpStatus&&(this._setStatus("pullUp",0),this.pullUpStatus=0)},_pullUpAgain:function(){this.page=1,5===this.pullUpStatus&&(this._setStatus("pullUp",0),this.pullUpStatus=0)},loadUp:function(t){var l=this,s=l.el,n=l.myScroll;this.conf.getPullUpData(s,l.page,l.perpage,function(s){l._scrollRefresh(),n.refresh(),l.page++,s&&(l._setStatus("pullUp",5),l.pullUpStatus=5),t&&t()})},loadDown:function(l){var s=this,n=(s.el,s.myScroll);this.conf.getPullDownData(t(this.el).find(".init-data"),function(){s._scrollRefresh(),n.refresh(),l&&l()})},loadFresh:function(l){var s=this,n=(s.el,s.myScroll);this.conf.getInitData(t(this.el).find(".init-data"),function(){s._scrollRefresh(),s.conf.freshWithClear&&s._pullUpAgain(),n.refresh(),s.page=2,l&&l()})}},o}"function"==typeof define&&define.amd?define("GLoadMore",["require","jquery","iscroll"],function(l){return t(l("jquery"),l("iscroll"))}):"object"==typeof module&&"object"==typeof module.exports?module.exports=t(require("jquery"),require("iscroll")):window.GLoadmore=t(window.jQuery,window.iscroll)}();