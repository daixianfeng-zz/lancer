!function(){function e(e,i,n,o){HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(e,t,i){for(var n=atob(this.toDataURL(t,i).split(",")[1]),o=n.length,r=new Uint8Array(o),s=0;s<o;s++)r[s]=n.charCodeAt(s);e(new Blob([r],{type:t||"image/png"}))}});var r={getUploadData:function(){return{}},onProgress:function(e){},onComplete:function(e,t){e&&console.log(e)},onReset:function(){},onTips:function(e){console.log(e)},fileKey:"files",typeReg:/^image/,maxSize:2*n.MB,autoUpload:!0,afterLoad:function(){}},s={getUploadData:function(){return{}}},a=function(t,i){this.el=e(t)[0],this.init(),this.config=e.extend({},r,i),this.files=[]};a.prototype={init:function(){var t=this;n.event.on(this.el,"change",function(i){var o=n.getFiles(i);n.filterFiles(o,function(e,i){return t.config.typeReg.test(e.type)?!(e.size>t.config.maxSize)||(t.config.onTips("ERROR_MAX_SIZE"),!1):(t.config.onTips("ERROR_FILE_TYPE"),!1)},function(i,o){0!==i.length&&(t.clearFile(),t.config.onReset(),n.each(i,function(i){var o=n.Image(i);t._crop(o).get(function(i,n){var o=e("<img />");o[0].src=n.toDataURL("image/png"),t.config.container&&e(t.config.container).append(o),t.config.autoUpload||t.config.afterLoad(o)})}),t.config.autoUpload&&(t.pushFile(i),t.upload()))})})},pushFile:function(e){return this.files.push(e)},clearFile:function(){this.files=[]},upload:function(){var e=this.files,t=this,i=t.config.getUploadData(),o={};o[t.config.fileKey]=e,n.upload({url:t.config.uploadUrl,data:i,files:o,progress:function(e){t.config.onProgress(e)},complete:function(e,i){t.config.onComplete(e,i)}})},_crop:function(e){var t=[];return this.config.resizeArgs&&(3===(t=this.config.resizeArgs).length?e.resize(t[0],t[1],t[2]):2===t.length&&e.resize(t[0],t[1])),this.config.cropArgs&&(4===(t=this.config.cropArgs).length?e.crop(t[0],t[1],t[2],t[3]):2===t.length&&e.crop(t[0],t[1])),this.config.previewArgs&&(2===(t=this.config.previewArgs).length?e.preview(t[0],t[1]):1===t.length&&e.preview(t[0])),this.config.rotateArgs&&1===(t=this.config.rotateArgs).length&&e.rotate(t[0]),e}};var l=function(t,i){this.$el=e(t),this.config=e.extend({},s,i),this.resultCanvas=null,this.resultImg=null,this.init()};return l.prototype={init:function(){var e=this.config.cropperConfig;this.$el.cropper(e)},crop:function(){var t=this.$el.cropper("getCroppedCanvas");return this.resultCanvas=t,this.resultImg="",this.config.resultContainer&&e(this.config.resultContainer).append(t),t},canvasToImage:function(){if(this.resultImg)return this.resultImg;var e=new Image;return e.src=this.resultCanvas.toDataURL("image/png"),this.resultImg=e,e},pushFile:function(e){e.pushFile(this.resultCanvas),this.resultCanvas.toBlob(function(t){var i=new Date,n=t;n.name="img"+ +i+".png",n.lastModified=+i,n.lastModifiedDate=i,n.constructor=File,e.pushFile(n)})},upload:function(e){e.upload()}},window.gUpload=t={GFile:a,GCut:l},t}var t=window.gUpload||{};"function"==typeof define&&define.amd?define("gUpload",["require","jquery","G","FileAPI","cropper"],function(t){return e(t("jquery"),t("G"),t("FileAPI"),t("cropper"))}):"object"==typeof module&&"object"==typeof module.exports?module.exports=e(require("jquery"),require("G"),require("FileAPI"),require("cropper")):e(window.jQuery,window.G,window.FileAPI,window.cropper)}();