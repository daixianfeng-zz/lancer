!function(){function t(t,o){function n(t){return+(Math.floor(100*t)/100).toFixed(2)}(e=function(t){return this.startDate=a(t.interestStartDate),this.endDate=a(t.interestEndDate),this.duration=+t.duration,this.duration=this.duration||(+this.endDate-this.startDate)/1e3/3600/24,this.rate=+t.interestRate,this.type=t.productType,this.retainSum=+t.retainSum||0,this.totalSum=+t.totalSum-this.retainSum,this.repayDate=+t.repayDate||20,this.monthRate=[],this.monthDays=[],this.repayTime=[],this.monthShouldPayRate=[],this.totalShouldPayRate=0,this.totalMonthRate=1,this.init(),this}).prototype={init:function(){amount=this.totalSum,"epiMonth"===this.type?this.totalRepayPlan=this.calcEpiMonth(amount):"epiNormal"===this.type&&(this.totalRepayPlan=this.calcEpiNormal(amount))},calc:function(t){return t=t||0,"fixed"===this.type||"greenHand"===this.type?this.calcFixed(t):"epiMonth"===this.type?this.calcApartEpiMonth(t):"epiNormal"===this.type?this.calcApartEpiNormal(t):void 0},calcFixed:function(t){return Math.round(this.rate*this.duration*t/365*100)/100},calcEpiMonth:function(t){return this.monthRate&&0!==this.monthRate.length||this.initMonthRate(),this.calcMonthPlan(t)},calcApartEpiMonth:function(t){return this.monthRate&&0!==this.monthRate.length||this.initMonthRate(),this.calcApartMonthPlan(t)},initMonthRate:function(){var e=this;e.firstRepay=new Date(e.startDate.getFullYear(),e.startDate.getMonth()+1,e.repayDate),e.firstRepay>=e.endDate&&(e.firstRepay=e.endDate),e.repayTime.push(o.dateFormat(e.firstRepay)),e.lastRepay=e.endDate,e.monthDays[0]=(+e.firstRepay-+e.startDate)/3600/24/1e3;for(var a=e.firstRepay,n=e.firstRepay,i=0;n<e.lastRepay;i++)a=n,(n=new Date(a.getFullYear(),a.getMonth()+1,a.getDate()))<e.lastRepay?(e.monthDays.push((+n-+a)/3600/24/1e3),e.repayTime.push(o.dateFormat(n))):(e.monthDays.push((+e.lastRepay-+a)/3600/24/1e3),e.repayTime.push(o.dateFormat(e.lastRepay)));t.each(e.monthDays,function(t,a){e.monthRate[t]=1+e.rate/12/30*a}),e.totalMonthRate=1,t.each(e.monthRate,function(t,a){e.totalMonthRate*=a}),e.monthShouldPayRate=[1];for(var r=e.monthRate.length,i=0;i<r-1;i++)e.monthShouldPayRate.push(e.monthRate[r-1-i]*e.monthShouldPayRate[i]);e.repayNum=r,e.totalShouldPayRate=0,t.each(e.monthShouldPayRate,function(t,a){e.totalShouldPayRate+=a})},calcMonthShouldRepay:function(t){return+(t*this.totalMonthRate/this.totalShouldPayRate).toFixed(2)},calcMonthPlan:function(t){for(var e=this,a=e.calcMonthShouldRepay(t),o=[],n=[],i=[],r=t,h=0,p=0,s=0;s<e.repayNum-1;s++)o[s]=+((e.monthRate[s]-1)*r).toFixed(2),n[s]=+(a-o[s]).toFixed(2),i[s]=a,r-=n[s],h+=n[s],p+=o[s];var m=+(t-h).toFixed(2),l=+((e.monthRate[e.repayNum-1]-1)*m).toFixed(2);return n.push(m),o.push(l),i.push(+(m+l).toFixed(2)),p+=l,{monthShouldRepay:a,monthRepay:i,monthPriciple:n,monthInterest:o,totalInterest:+p.toFixed(2),totalRepay:+(t+p).toFixed(2),repayNum:e.repayNum,repayTime:e.repayTime}},calcApartMonthPlan:function(t){var e=this.totalRepayPlan,a=t/this.totalSum,o={repayNum:this.repayNum,repayTime:this.repayTime};o.monthShouldRepay=n(+(e.monthShouldRepay*a).toFixed(6)),o.totalInterest=n(+(e.totalInterest*a).toFixed(6)),o.totalRepay=n(+(t+o.totalInterest).toFixed(6)),o.monthRepay=[],o.monthPriciple=[],o.monthInterest=[];for(var i=0,r=0,h=0;h<this.repayNum-1;h++)o.monthRepay[h]=n(+(e.monthRepay[h]*a).toFixed(6)),o.monthInterest[h]=n(+(e.monthInterest[h]*a).toFixed(6)),o.monthPriciple[h]=+(o.monthRepay[h]-o.monthInterest[h]).toFixed(2),i+=o.monthPriciple[h],r+=o.monthInterest[h];return o.monthInterest[this.repayNum-1]=+(o.totalInterest-r).toFixed(2),o.monthPriciple[this.repayNum-1]=+(t-i).toFixed(2),o.monthRepay[this.repayNum-1]=+(o.monthInterest[this.repayNum-1]+o.monthPriciple[this.repayNum-1]).toFixed(2),o},calcEpiNormal:function(t){return this.normalRate&&this.repayNum&&0!==this.repayTime.length||this.initNormalRate(),this.calcNormalPlan(t)},calcApartEpiNormal:function(t){return this.normalRate&&this.repayNum&&0!==this.repayTime.length||this.initNormalRate(),this.calcApartNormalPlan(t)},initNormalRate:function(){var t=this;t.normalRate=t.rate/12,t.repayNum=0,t.repayTime=[];for(var e=t.startDate,a={},n={};e<t.endDate;)t.repayNum+=1,a=new Date(new Date(t.startDate).setMonth(t.startDate.getMonth()+t.repayNum)),n=new Date(new Date(t.startDate).setMonth(t.startDate.getMonth()+t.repayNum+1)),(e=a<(n=new Date(n.setDate(0)))?a:n)<=t.endDate?t.repayTime.push(o.dateFormat(e)):t.repayTime.push(o.dateFormat(t.endDate))},calcMonthRepay:function(t,e){return+(t*this.normalRate*Math.pow(1+this.normalRate,e)/(Math.pow(1+this.normalRate,e)-1)).toFixed(2)},calcMonthPrincipal:function(t,e,a){return+(t*this.normalRate*Math.pow(1+this.normalRate,a-1)/(Math.pow(1+this.normalRate,e)-1)).toFixed(2)},calcNormalPlan:function(t){for(var e=this,a=e.calcMonthRepay(t,e.repayNum),o=[],n=[],i=[],r=0,h=0,p=0;p<e.repayNum-1;p++)o[p]=+(a-e.calcMonthPrincipal(t,e.repayNum,p+1)).toFixed(2),n[p]=e.calcMonthPrincipal(t,e.repayNum,p+1),i[p]=a,n[p],r+=n[p],h+=o[p];var s=+(t-r).toFixed(2),m=+(a-s).toFixed(2);return n.push(s),o.push(m),i.push(+a.toFixed(2)),h+=m,{monthShouldRepay:a,monthRepay:i,monthPriciple:n,monthInterest:o,totalInterest:+h.toFixed(2),totalRepay:+(t+h).toFixed(2),repayNum:e.repayNum,repayTime:e.repayTime}},calcApartNormalPlan:function(t){var e=this.totalRepayPlan,a=t/this.totalSum,o={repayNum:this.repayNum,repayTime:this.repayTime};o.monthShouldRepay=n(+(e.monthShouldRepay*a).toFixed(6)),o.totalInterest=n(+(e.totalInterest*a).toFixed(6)),o.totalRepay=n(+(t+o.totalInterest).toFixed(6)),o.monthRepay=[],o.monthPriciple=[],o.monthInterest=[];for(var i=0,r=0,h=0,p=0;p<this.repayNum-1;p++)o.monthRepay[p]=n(+(e.monthRepay[p]*a).toFixed(6)),o.monthInterest[p]=n(+(e.monthInterest[p]*a).toFixed(6)),o.monthPriciple[p]=+(o.monthRepay[p]-o.monthInterest[p]).toFixed(2),i+=o.monthPriciple[p],r+=o.monthInterest[p],h+=o.monthRepay[p];return o.monthRepay[this.repayNum-1]=+(o.totalRepay-h).toFixed(2),o.monthPriciple[this.repayNum-1]=+(t-i).toFixed(2),o.monthInterest[this.repayNum-1]=+(o.monthRepay[this.repayNum-1]-o.monthPriciple[this.repayNum-1]).toFixed(2),o}},window.CalcProduct=e}var e={};"function"==typeof define&&define.amd?define("CalcProduct",["require","jquery","G"],function(a){return t(a("jquery"),a("G")),e}):"object"==typeof module&&"object"==typeof module.exports?(t(require("jquery"),require("G")),module.exports=e):t(window.jQuery,window.G);var a=function(t){if(!t||!t.split)return+new Date;var e=t.split("-"),a=new Date,o=a;if(e[0]&&e[1]){var n=e[2]?+e[0]:a.getFullYear(),i=e[2]?+e[1]:+e[0],r=e[2]?+e[2]:+e[1];o=new Date(+n,+i-1,+r)}return o}}();